<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pend√™ncias das M√°quinas</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <h2>Pend√™ncias das M√°quinas - Ventos de Serra do Mel II</h2>

    <div id="lista-parques"></div>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/

firebasejs/9.6.1/firebase-firestore-compat.js"></script>

    <script>
        console.log("üöÄ Firebase carregado na p√°gina de pend√™ncias!");

        // Configura√ß√£o do Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyCe_AbmxlZYUDAaatxQ3FH5h6ZeiAK1Qq4",
            authDomain: "meusite-132ec.firebaseapp.com",
            projectId: "meusite-132ec",
            storageBucket: "meusite-132ec.appspot.com",
            messagingSenderId: "558888153171",
            appId: "1:558888153171:web:5845f24da583581aa556a6",

            measurementId: "G-4WW93D6ZD6"
        };

        // Inicializa Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        async function carregarPendencias() {
            const listaParques = document.getElementById("lista-parques");
            listaParques.innerHTML = "";

            const parques = ["VPB III", "VPB IV", "VMA I", "VMA II"];

            for (let parque of parques) {
                const parqueDiv = document.createElement("div");
                parqueDiv.innerHTML = `<h3>${parque}</h3>`;

                const maquinas = [

                    `${parque}-01`, `${parque}-02`, `${parque}-03`, `${parque}-04`, 
                    `${parque}-05`, `${parque}-06`, `${parque}-07`, `${parque}-08`, `${parque}-09`
                ];

                for (let maquina of maquinas) {
                    // Criando um novo container para a m√°quina
                    const maquinaDiv = document.createElement("div");

                    // Criando o t√≠tulo da m√°quina
                    const tituloMaquina = document.createElement("h4");
                    tituloMaquina.textContent = maquina;

                    // Criando a lista UL onde as pend√™ncias ser√£o exibidas
                    const pendenciasUl = 

document.createElement("ul");
                    pendenciasUl.id = `pendencias-${maquina}`;
                    pendenciasUl.innerHTML = "Carregando...";

                    // Adicionamos o t√≠tulo e a lista ao container da m√°quina
                    maquinaDiv.appendChild(tituloMaquina);
                    maquinaDiv.appendChild(pendenciasUl);
                    parqueDiv.appendChild(maquinaDiv);

                    // Agora que o elemento UL foi criado e adicionado ao DOM, podemos limp√°-lo corretamente
                    pendenciasUl.innerHTML = "";

                    // Buscar pend√™ncias no Firestore

                    try {
                        const snapshot = await db.collection("relatorios").where("maquina", "==", maquina).get();

                        if (snapshot.empty) {
                            console.warn(`‚ö†Ô∏è Nenhuma pend√™ncia encontrada para ${maquina}.`);
                            pendenciasUl.innerHTML = "<li>Sem pend√™ncias registradas.</li>";
                        } else {
                            pendenciasUl.innerHTML = ""; // Limpa a lista antes de adicionar itens

                            snapshot.forEach(async doc => {
                                const data = doc.data();
                                const pendenciaCodigo = data.pendencia ? data.pendencia : "C√≥digo n√£o encontrado"; // Ex: "P123"
                                const dataTexto = data.data ? data.data : "Data n√£o informada";


                                // Agora buscamos a descri√ß√£o da pend√™ncia na cole√ß√£o "pendencias"
                                let descricaoPendencia = "Descri√ß√£o n√£o encontrada";

                                try {
                                    const pendenciaDoc = await db.collection("pendencias").doc(pendenciaCodigo).get();
                                    if (pendenciaDoc.exists) {
                                        descricaoPendencia = pendenciaDoc.data().descricao;
                                    }
                                } catch (error) {
                                    console.error(`‚ùå Erro ao buscar descri√ß√£o da pend√™ncia ${pendenciaCodigo}:`, error);
                                }


                                // Criar e adicionar a pend√™ncia na lista
                                const li = document.createElement("li");
                                li.textContent = `${pendenciaCodigo} - ${descricaoPendencia} - ${dataTexto}`;
                                pendenciasUl.appendChild(li);
                            });
                        }
                    } catch (error) {
                        console.error(`‚ùå Erro ao buscar pend√™ncias para ${maquina}:`, error);
                        pendenciasUl.innerHTML = "<li>Erro ao carregar pend√™ncias.</li>";
                    }
                }

                

listaParques.appendChild(parqueDiv);
            }
        }

        document.addEventListener("DOMContentLoaded", carregarPendencias);
    </script>

</body>
</html>
